<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Free Assets Roblox Studio - JarsDev</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* === RESET DAN VARIABEL === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #667eea;
      --primary-light: #764ba2;
      --secondary: #f093fb;
      --accent: #4facfe;
      --dark: #0a0e27;
      --dark-alt: #13182b;
      --card: rgba(255,255,255,0.05);
      --card-hover: rgba(255,255,255,0.08);
      --text: #ffffff;
      --text-dim: #a0aec0;
      --success: #00d9ff;
      --danger: #ff6b9d;
      --glass: rgba(255,255,255,0.1);
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--dark);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
      position: relative;
    }

    /* === BACKGROUND ANIMASI === */
    .bg-animation {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 0;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%);
      opacity: 0.05;
    }
    .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
    .particle {
      position: absolute; background: rgba(255,255,255,0.5); border-radius: 50%;
      animation: float 15s infinite ease-in-out;
    }
    @keyframes float {
      0%,100% { transform: translateY(0) translateX(0); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
    }

    /* === HEADER === */
    header {
      position: sticky; top: 0;
      z-index: 1000;
      background: rgba(10,14,39,0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 1rem 0;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .header-container {
      max-width: 1400px; margin: 0 auto;
      padding: 0 2rem;
      display: flex; justify-content: space-between; align-items: center;
    }
    .logo-container { display: flex; align-items: center; gap: 1rem; cursor: pointer; transition: transform 0.3s ease; }
    .logo-container:hover { transform: scale(1.05); }
    .logo-icon { position: relative; width: 50px; height: 50px; }
    .logo-cube {
      position: absolute; width: 100%; height: 100%;
      background: linear-gradient(135deg,var(--primary),var(--secondary));
      border-radius: 12px;
      animation: spin 10s infinite linear;
      box-shadow: 0 0 30px rgba(102,126,234,0.5);
    }
    @keyframes spin { 0%{transform:rotateY(0)}100%{transform:rotateY(360deg)} }
    .logo-title {
      font-size: 1.5rem; font-weight: 800;
      background: linear-gradient(135deg,var(--primary),var(--secondary));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .logo-subtitle { font-size: 0.75rem; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; }

    /* === SEARCH === */
    .search-section { position: relative; z-index: 2; max-width: 1400px; margin: 3rem auto; padding: 0 2rem; }
    .search-wrapper { max-width: 600px; margin: 0 auto; position: relative; }
    .search-box {
      position: relative;
      background: var(--glass); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 50px; padding: 1rem 4rem 1rem 2rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    .search-box input {
      width: 100%; border: none; background: transparent; color: var(--text);
      font-size: 1rem; outline: none;
    }
    .search-icon { position: absolute; right: 2rem; top: 50%; transform: translateY(-50%); color: var(--text-dim); font-size: 1.2rem; }

    /* === HERO SECTION === */
    .hero { text-align: center; padding: 3rem 2rem; margin-bottom: 3rem; }
    .hero h1 {
      font-size: 3.5rem; font-weight: 800; margin-bottom: 1rem;
      background: linear-gradient(135deg,var(--primary),var(--secondary),var(--accent));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-size: 200% 200%;
      animation: gradientSlide 5s ease infinite;
    }
    @keyframes gradientSlide { 0%,100%{background-position:0% 50%}50%{background-position:100% 50%} }

    .stats {
      display: flex; justify-content: center; align-items: center; gap: 3rem; margin-top: 2rem;
    }
    .stat-item { text-align: center; }
    .stat-number { font-size: 1.5rem; font-weight: 700; color: var(--success); }

    /* === CARD MODEL === */
    .models-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }
    .model-card {
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      transition: all 0.4s ease;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .model-card:hover { background: var(--card-hover); transform: translateY(-4px); }
    .model-thumbnail {
      width: 100%; height: 220px;
      background: var(--dark-alt);
      display: flex; align-items: center; justify-content: center;
    }
    .model-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
    .model-info { padding: 1.5rem; }
    .model-title { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.5rem; }
    .model-desc { color: var(--text-dim); font-size: 0.95rem; margin-bottom: 1rem; }
    .btn-download {
      flex: 1; background: linear-gradient(135deg,var(--success),#00b8d4);
      color: white; padding: 0.85rem; border: none; border-radius: 12px;
      cursor: pointer; font-weight: 600; transition: all 0.3s ease;
      width: 100%;
    }
    .btn-download:hover { opacity: 0.9; }

    /* === LOADING + EMPTY === */
    .loading { text-align: center; padding: 4rem 2rem; color: var(--text-dim); font-size: 1.1rem; }
    .loading i { margin-right: 0.5rem; animation: spin 1s linear infinite; }

    .empty-state { text-align: center; padding: 5rem 2rem; color: var(--text-dim); }

    @media (max-width:768px){
      .hero h1{font-size:2.5rem}
      .stats{flex-direction:column;gap:1rem}
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  <div class="particles" id="particles"></div>

  <header>
    <div class="header-container">
      <div class="logo-container">
        <div class="logo-icon"><div class="logo-cube"></div></div>
        <div class="logo-text"><div class="logo-title">JarsDev</div><div class="logo-subtitle">Roblox Assets</div></div>
      </div>
      <div class="header-actions" id="headerActions"></div>
    </div>
  </header>

  <div class="search-section" id="searchSection">
    <div class="search-wrapper">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Cari model..." oninput="searchModels()">
        <i class="fas fa-search search-icon"></i>
      </div>
    </div>
  </div>

  <div class="container">
    <div id="homePage">
      <div class="hero">
        <h1>Free Assets Roblox Studio</h1>
        <p>Download koleksi model Roblox Studio berkualitas tinggi secara gratis!</p>
        <div class="stats">
          <div class="stat-item">
            <div class="stat-number" id="totalModels">0</div>
            <div class="stat-label">Total Models</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="totalDownloads">0</div>
            <div class="stat-label">Downloads</div>
          </div>
        </div>
      </div>

      <div id="loadingModels" class="loading">
        <i class="fas fa-spinner"></i> Memuat koleksi...
      </div>
      <div id="modelsContainer" class="models-grid"></div>
      <div id="noModels" class="empty-state" style="display:none;">
        <i class="fas fa-box-open"></i>
        <h2>Belum Ada Model</h2>
        <p>Admin belum mengupload model apapun.</p>
      </div>
    </div>
<!-- ======================== SCRIPT FIREBASE ======================== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";
  import { getDatabase, ref, set, get, child, update, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  // ðŸ”¥ CONFIG kamu
  const firebaseConfig = {
    apiKey: "AIzaSyDY-3QUGeshEhuVU0g5JwNpZd2oYAYwR9A",
    authDomain: "forum-diskus.firebaseapp.com",
    databaseURL: "https://forum-diskus-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "forum-diskus",
    storageBucket: "forum-diskus.appspot.com",
    messagingSenderId: "434039824623",
    appId: "1:434039824623:web:8f2bbc06217bd06fd4bb1a",
    measurementId: "G-CH710HB633"
  };

  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  const db = getDatabase(app);

  /* =======================
     VARIABEL GLOBAL
     ======================= */
  let isLoggedIn = false;
  let currentModelFile = null;
  let currentThumbFile = null;
  let models = [];

  const ADMIN_KEY = "JarsDev2025";

  /* =======================
     HASH & LOGIN ADMIN
     ======================= */
  async function hashString(str) {
    const enc = new TextEncoder();
    const data = enc.encode(str);
    const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    return Array.from(new Uint8Array(hashBuffer))
      .map(b => b.toString(16).padStart(2, "0"))
      .join("");
  }

  async function setAdminCredentials(username, password, key) {
    if (key !== ADMIN_KEY) {
      Swal.fire({ icon: "error", title: "Kunci admin salah!", background: "#13182b", color: "#fff" });
      return;
    }
    const hash = await hashString(`${username}:${password}`);
    localStorage.setItem("adminHash", hash);
    Swal.fire({ icon: "success", title: "Admin disetup!", background: "#13182b", color: "#fff" });
  }

  async function login(e) {
    e.preventDefault();
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    const hash = localStorage.getItem("adminHash");
    if (!hash) {
      Swal.fire({ icon: "error", title: "Belum ada admin!", text: "Gunakan setAdminCredentials di console.", background: "#13182b", color: "#fff" });
      return;
    }
    const attempt = await hashString(`${u}:${p}`);
    if (attempt === hash) {
      isLoggedIn = true;
      localStorage.setItem("adminLoggedIn", "true");
      closeLoginModal();
      updateUI();
      Swal.fire({ icon: "success", title: "Login Berhasil!", background: "#13182b", color: "#fff", timer: 1500, showConfirmButton: false });
    } else {
      Swal.fire({ icon: "error", title: "Login Gagal!", background: "#13182b", color: "#fff" });
    }
  }

  function logout() {
    localStorage.removeItem("adminLoggedIn");
    isLoggedIn = false;
    updateUI();
  }

  function checkLoginStatus() {
    if (localStorage.getItem("adminLoggedIn") === "true") {
      isLoggedIn = true;
      updateUI();
    }
  }

  /* =======================
     UPLOAD FILE + DB
     ======================= */
  async function uploadFileToStorage(file, folder) {
    const path = `${folder}/${Date.now()}_${file.name}`;
    const storageRef = sRef(storage, path);
    await uploadBytes(storageRef, file);
    return await getDownloadURL(storageRef);
  }

  async function uploadModel(e) {
    e.preventDefault();
    const fileUrl = document.getElementById("fileUrlInput").value.trim();
    const name = document.getElementById("modelName").value.trim();
    const desc = document.getElementById("modelDesc").value.trim();

    if (!name || !desc) {
      Swal.fire({ icon: "warning", title: "Isi semua field!", background: "#13182b", color: "#fff" });
      return;
    }
    if (!currentModelFile && !fileUrl) {
      Swal.fire({ icon: "warning", title: "Tidak ada file!", background: "#13182b", color: "#fff" });
      return;
    }

    Swal.fire({ title: "Mengunggah...", allowOutsideClick: false, didOpen: () => Swal.showLoading(), background: "#13182b", color: "#fff" });

    try {
      let modelURL = fileUrl ? googleDriveToDirect(fileUrl) : await uploadFileToStorage(currentModelFile, "models");
      let thumbURL = currentThumbFile ? await uploadFileToStorage(currentThumbFile, "thumbnails") : null;

      const id = Date.now().toString();
      const modelData = {
        id,
        name,
        description: desc,
        fileUrl: modelURL,
        thumbUrl: thumbURL,
        uploadDate: new Date().toISOString(),
        downloads: 0
      };
      await set(ref(db, "models/" + id), modelData);

      Swal.fire({ icon: "success", title: "Upload Berhasil!", background: "#13182b", color: "#fff" });
      document.getElementById("uploadForm").reset();
      clearFile(); clearThumb();
      loadModels();
    } catch (err) {
      Swal.fire({ icon: "error", title: "Upload Gagal!", text: err.message, background: "#13182b", color: "#fff" });
    }
  }

  async function loadModels() {
    const snapshot = await get(child(ref(db), "models"));
    if (snapshot.exists()) {
      models = Object.values(snapshot.val()).sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));
      displayModels(models);
    } else {
      models = [];
      displayModels([]);
    }
  }

  async function downloadModel(id, name) {
    const snap = await get(child(ref(db), "models/" + id));
    if (!snap.exists()) return;
    const m = snap.val();

    const link = document.createElement("a");
    link.href = m.fileUrl;
    link.target = "_blank";
    link.download = m.name || `${id}.rbxm`;
    link.click();

    await update(ref(db, "models/" + id), { downloads: (m.downloads || 0) + 1 });
    loadModels();
  }

  async function deleteModel(id) {
    if (!confirm("Yakin ingin hapus model ini?")) return;
    await remove(ref(db, "models/" + id));
    loadModels();
  }

  /* =======================
     FILE HANDLER
     ======================= */
  function handleFileSelect(e) {
    const f = e.target.files[0];
    if (f) {
      currentModelFile = f;
      document.getElementById("fileName").textContent = f.name;
      document.getElementById("fileInfo").classList.add("active");
    }
  }
  function handleThumbnailSelect(e) {
    const f = e.target.files[0];
    if (f) {
      currentThumbFile = f;
      document.getElementById("thumbName").textContent = f.name;
      document.getElementById("thumbInfo").classList.add("active");
    }
  }
  function clearFile() {
    currentModelFile = null;
    document.getElementById("fileInfo").classList.remove("active");
  }
  function clearThumb() {
    currentThumbFile = null;
    document.getElementById("thumbInfo").classList.remove("active");
  }
  function googleDriveToDirect(url) {
    try {
      const d = new URL(url);
      if (d.hostname.includes("drive.google.com")) {
        const path = d.pathname.split("/");
        const idIndex = path.indexOf("d");
        if (idIndex !== -1 && path[idIndex + 1])
          return `https://drive.google.com/uc?export=download&id=${path[idIndex + 1]}`;
        const idParam = d.searchParams.get("id");
        if (idParam)
          return `https://drive.google.com/uc?export=download&id=${idParam}`;
      }
    } catch {}
    return url;
  }

  /* =======================
     UI TAMPILAN
     ======================= */
  function displayModels(list) {
    const c = document.getElementById("modelsContainer");
    c.innerHTML = "";
    if (!list.length) {
      document.getElementById("noModels").style.display = "block";
      document.getElementById("loadingModels").style.display = "none";
      return;
    }
    document.getElementById("noModels").style.display = "none";
    document.getElementById("loadingModels").style.display = "none";

    list.forEach(m => {
      c.innerHTML += `
        <div class="model-card">
          ${m.thumbUrl
            ? `<div class="model-thumbnail"><img src="${m.thumbUrl}" alt="${m.name}"></div>`
            : `<div class="model-thumbnail"><i class="fas fa-cube"></i></div>`}
          <div class="model-info">
            <h3 class="model-title">${m.name}</h3>
            <p class="model-desc">${m.description}</p>
            <button class="btn-download" onclick="downloadModel('${m.id}','${m.name}')">
              <i class="fas fa-download"></i> Unduh
            </button>
          </div>
        </div>`;
    });

    document.getElementById("totalModels").textContent = list.length;
    document.getElementById("totalDownloads").textContent = list.reduce((a, b) => a + (b.downloads || 0), 0);
  }

  function updateUI() {
    document.getElementById("uploadSection").classList.toggle("active", isLoggedIn);
    document.getElementById("homePage").style.display = isLoggedIn ? "none" : "block";
    document.getElementById("searchSection").style.display = isLoggedIn ? "none" : "block";
  }

  function showLoginModal() {
    document.getElementById("loginModal").classList.add("active");
  }
  function closeLoginModal() {
    document.getElementById("loginModal").classList.remove("active");
  }

  /* =======================
     INIT
     ======================= */
  window.setAdminCredentials = setAdminCredentials;
  window.login = login;
  window.logout = logout;
  window.uploadModel = uploadModel;
  window.downloadModel = downloadModel;
  window.deleteModel = deleteModel;
  window.handleFileSelect = handleFileSelect;
  window.handleThumbnailSelect = handleThumbnailSelect;
  window.clearFile = clearFile;
  window.clearThumb = clearThumb;
  window.showLoginModal = showLoginModal;
  window.closeLoginModal = closeLoginModal;

  document.addEventListener("DOMContentLoaded", () => {
    checkLoginStatus();
    loadModels();
  });
</script>
</body>
</html>
